# Legacy Helper Removal Mapping

Generated on $(date --utc +"%Y-%m-%dT%H:%M:%SZ") to track replacement strategy for deprecated `ClientManager` helpers.

## Helper Replacement Strategy

| Helper                                             | Primary Call Sites                                                                                                                                                                                                                                                                            | Replacement Strategy                                                                                                                                                                                                                                           |
| -------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `get_embedding_manager`                            | `src/services/dependencies.py`, `src/mcp_tools/tools/embeddings.py`, `src/crawl4ai_bulk_embedder.py`, `src/manage_vector_db.py`, `src/cli/commands/database.py`, tests under `tests/unit/mcp_tools/tools/test_embeddings.py`, `tests/unit/services/embeddings/test_crawl4ai_bulk_embedder.py` | Replace with direct construction or DI-provided `EmbeddingManager` (core manager) where lifecycle required; prefer using `src/services.embeddings.manager.EmbeddingManager` directly via DI container for services, and functional dependencies for CLI/tools. |
| `get_cache_manager`                                | `src/services/dependencies.py`, `src/mcp_tools/tools/cache.py`, `src/mcp_tools/tools/documents.py`, `src/mcp_tools/tools/collection_management.py`, `src/unified_mcp_server.py`, tests referencing cache manager                                                                              | Provide singleton via `get_cache_manager` dependency function backed by `CacheManager`; share instance across services with explicit cleanup.                                                                                                                  |
| `get_crawl_manager` / alias `get_crawling_manager` | `src/services/dependencies.py`, `src/mcp_tools/tools/crawling.py`, `src/mcp_tools/tools/lightweight_scrape.py`, `src/mcp_tools/tools/documents.py`, `src/crawl4ai_bulk_embedder.py`, related tests                                                                                            | Construct `CrawlManager` directly within dependency layer; expose through async dependency helpers instead of ClientManager helpers.                                                                                                                           |
| `get_database_manager`                             | `src/services/dependencies.py`, `src/services/fastapi/dependencies/core.py`, `src/cli/commands/database.py`, `src/manage_vector_db.py`, tests                                                                                                                                                 | Initialize `DatabaseManager` via dependency helper that reuses core clients; remove ClientManager indirection.                                                                                                                                                 |
| `get_container` (FastAPI)                          | `src/services/fastapi/dependencies/core.py`, re-export packages                                                                                                                                                                                                                               | Rename to `get_app_dependency_container`; rely on function-based dependencies as primary interface.                                                                                                                                                            |
| `get_monitoring_manager`                           | `src/services/dependencies.py`, `src/services/observability/...` tests                                                                                                                                                                                                                        | Remove in favor of direct observability service dependencies; use `MonitoringManager` from DI where still required or substitute newer telemetry API.                                                                                                          |
| `get_qdrant_service`                               | Legacy references in older tests (`tests/unit/services/embeddings/test_crawl4ai_bulk_embedder.py`), ensure migration to `get_vector_store_service` or direct `VectorStoreService`.                                                                                                            | Redirect callers to dependency-injected `VectorStoreService` helpers. |
| `managed_client` legacy entries                    | All call sites using `client_manager.managed_client("embedding")` etc. (none current); ensure map only contains supported primitives (`openai`, `qdrant`, `redis`, `firecrawl`, `http`, `parallel_processing`).                                                                               | Remove unused registrations; integration tests confirm coverage. |

## Follow-up Tasks

1. Update DI container providers to surface concrete services (`EmbeddingManager`, `CrawlManager`, `CacheManager`, `DatabaseManager`) for direct injection.
2. Migrate FastAPI dependencies to construct services without ClientManager indirection.
3. Update MCP tools and CLI flows to leverage new dependency points with deterministic initialization/cleanup.
4. Align tests with new initialization strategy; replace mocks around removed helpers.

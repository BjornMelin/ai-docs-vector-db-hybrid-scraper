name: Test Composite Actions

on:
  workflow_dispatch:
  pull_request:
    paths:
      - '.github/actions/**'
      - '.github/workflows/test-composite-actions.yml'
      - 'scripts/ci/validate_config.py'

permissions:
  contents: read

jobs:
  setup-environment:
    name: Setup environment action
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8 # v5

      - name: Execute action
        id: setup
        uses: ./.github/actions/setup-environment
        with:
          python-version: '3.12'

      - name: Assert environment
        shell: bash
        run: |
          set -euo pipefail
          if [ "${{ steps.setup.outputs.cache-hit }}" = "true" ]; then
            echo "Cache restored"
          else
            echo "Cache miss"
          fi
          uv run python -c "import sys; print(sys.version)"

      - name: Run configuration validation helper
        shell: bash
        run: |
          set -euo pipefail
          uv run python scripts/ci/validate_config.py --environment development

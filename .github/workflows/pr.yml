name: Pull Request

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  validate:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'
      
      - name: Install uv
        uses: astral-sh/setup-uv@v4
        with:
          version: "latest"
          enable-cache: true
      
      - name: Install dependencies
        run: uv sync --dev --frozen
      
      - name: Run quick checks
        run: |
          echo "üîç Running quick validation checks..."
          
          # Check for merge conflicts
          if grep -r "<<<<<<< HEAD" --exclude-dir=.git .; then
            echo "‚ùå Merge conflicts detected"
            exit 1
          fi
          
          # Validate Python syntax
          uv run python -m py_compile src/**/*.py
          
          # Quick lint check
          uv run ruff check . --select=E9,F63,F7,F82
          
          echo "‚úÖ Quick checks passed"
      
      - name: Comment PR size
        uses: actions/github-script@v7
        with:
          script: |
            const pr = context.payload.pull_request;
            const additions = pr.additions;
            const deletions = pr.deletions;
            const total = additions + deletions;
            
            let sizeLabel = 'üü¢ Small';
            if (total > 1000) sizeLabel = 'üî¥ Large';
            else if (total > 500) sizeLabel = 'üü° Medium';
            
            const comment = `## PR Size Analysis
            
            ${sizeLabel} **Total changes:** ${total} lines
            - ‚ûï Additions: ${additions}
            - ‚ûñ Deletions: ${deletions}
            
            ${total > 500 ? '‚ö†Ô∏è Consider breaking this PR into smaller chunks for easier review.' : '‚úÖ Good PR size for review.'}`;
            
            github.rest.issues.createComment({
              issue_number: pr.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: comment
            });